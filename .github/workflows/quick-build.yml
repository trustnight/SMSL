name: Quick Build EXE

# ç®€åŒ–çš„å¿«é€Ÿæž„å»ºæµç¨‹
on:
  workflow_dispatch:  # ä»…æ‰‹åŠ¨è§¦å‘
    inputs:
      version:
        description: 'ç‰ˆæœ¬å· (ä¾‹å¦‚: v1.0.0)'
        required: false
        default: 'latest'
        type: string

jobs:
  quick-build:
    runs-on: windows-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
        
    - name: å®‰è£…ä¾èµ–å’ŒPyInstaller
      run: |
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: ä½¿ç”¨specæ–‡ä»¶æž„å»ºEXE
      run: |
        pyinstaller soul_launcher.spec --clean --noconfirm
        
    - name: éªŒè¯æž„å»ºç»“æžœ
      run: |
        if (Test-Path "dist\Soul Launcher.exe") {
          Write-Host "âœ… EXEæ–‡ä»¶æž„å»ºæˆåŠŸ"
          $fileSize = (Get-Item "dist\Soul Launcher.exe").Length / 1MB
          Write-Host "ðŸ“¦ æ–‡ä»¶å¤§å°: $([math]::Round($fileSize, 2)) MB"
        } else {
          Write-Host "âŒ EXEæ–‡ä»¶æž„å»ºå¤±è´¥"
          exit 1
        }
        
    - name: ä¸Šä¼ EXEæ–‡ä»¶
      uses: actions/upload-artifact@v3
      with:
        name: soul-launcher-${{ inputs.version }}
        path: dist/Soul Launcher.exe
        retention-days: 7
        
    - name: æž„å»ºæ‘˜è¦
      run: |
        echo "## ðŸŽ‰ æž„å»ºå®Œæˆ" >> $env:GITHUB_STEP_SUMMARY
        echo "" >> $env:GITHUB_STEP_SUMMARY
        echo "- **ç‰ˆæœ¬**: ${{ inputs.version }}" >> $env:GITHUB_STEP_SUMMARY
        echo "- **æž„å»ºæ—¶é—´**: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" >> $env:GITHUB_STEP_SUMMARY
        echo "- **æ–‡ä»¶å**: Soul Launcher.exe" >> $env:GITHUB_STEP_SUMMARY
        echo "" >> $env:GITHUB_STEP_SUMMARY
        echo "### ðŸ“¥ ä¸‹è½½æ–¹å¼" >> $env:GITHUB_STEP_SUMMARY
        echo "åœ¨Actionsé¡µé¢çš„Artifactséƒ¨åˆ†ä¸‹è½½æž„å»ºå¥½çš„EXEæ–‡ä»¶" >> $env:GITHUB_STEP_SUMMARY